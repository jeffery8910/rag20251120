# /admin 測試／聊天分步指引（JSON 模板版）

這份指南帶你用 `/admin` 的「測試／聊天」分頁，逐步體驗六種 RAG+LLM 結構化輸出：摘要、單選題、條列筆記、學習建議、表格、時間線。

## 事前確認
- 已登入 `/admin`（輸入 `ADMIN_TOKEN`）。
- 已上傳教材並完成嵌入（檔案或貼文字皆可）。
- 環境變數：`VECTOR_BACKEND=pinecone`，Gemini/Pinecone/LINE key 已就緒。

## 步驟
1) 開啟「測試／聊天」分頁  
   看到左側輸入框、右側聊天泡泡與結果卡片區。

2) 選擇輸出樣式  
   在「輸出樣式」下拉選擇：摘要 / 單選題 / 條列筆記 / 學習建議 / 表格 / 時間線。

3) 一鍵生成（推薦）  
   點右側快捷按鈕，例如「生成摘要」/「生成單選題」… 系統會自動填入相對應的 JSON 提示並送出。

4) 查看對話與渲染卡片  
   - 上方聊天泡泡：顯示問題與模型回覆（原文）。  
   - 下方卡片：依模式渲染對應區塊：  
     - 摘要：摘要 + 重點 bullets + 來源列表  
     - 單選題：題幹、選項、答案與理由  
     - 條列筆記：5 條精簡筆記  
     - 學習建議：5 條下一步建議  
     - 表格：headers + rows + source  
     - 時間線：事件標題 / 日期 / 描述

5) 檢視原始 JSON  
   展開「以 JSON 檢視」可複製整份原始輸出，方便貼回教案或其他系統。

6) 調整 TopK / ScoreThreshold  
   回到「參數設定」分頁，微調檢索參數，再回測試分頁重送即可對比命中率與品質。

7) 多輪問答  
   直接在輸入框再問下一題，聊天泡泡會持續累積，可用來示範「上下文保持 + 不同模板」的效果。

8) 角色/學生切換  
   右上「身分」下拉可切換 teacher / student-a / student-b，系統會以 userId 傳給後端，可用來演示 namespace 分流或個人化（需要對應資料準備）。

## 常見問題
- 沒有結果或結構怪：確認教材涵蓋問題，或降 ScoreThreshold / 提升 TopK。
- JSON 無法解析：LLM 亂出格式時重送一次；本前端已嘗試自動擷取第一段 JSON。
- 表格/時間線空白：代表教材缺乏可結構化資訊，請更精確提問或補充資料。

## 快捷提示（如需手動輸入）
- 摘要：200 字摘要 + 3 重點 + 來源 JSON。
- 單選題：3 題 MCQ，含答案與解釋。
- 條列筆記：5 條筆記 + 頁碼。
- 學習建議：5 條下一步建議 + 頁碼。
- 表格：指定 headers/rows + source。
- 時間線：事件/日期/描述 + 頁碼。
